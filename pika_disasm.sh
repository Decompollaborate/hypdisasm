#!/bin/bash
set -e

if [[ $# -le 0 ]]
then
    echo "Usage: $0 [us|jp]"
    exit 1
fi

VERSION=$1

FUNCTIONS="ver/${VERSION}/tables/functions.csv"
VARIABLES="ver/${VERSION}/tables/variables.csv"

BASEROM_DIR="ver/${VERSION}/baserom"
ASM_DIR="ver/${VERSION}/asm/text"
DATA_DIR="ver/${VERSION}/asm/data"
TABLES_DIR="ver/${VERSION}/tables"
CONTEXT_DIR="ver/${VERSION}/context"

./tools/64scripts/n64reader/n64reader.elf "${BASEROM_DIR}/makerom.bin" -e entrypoint -a -u > "${ASM_DIR}/makerom/rom_header.s"
echo ".incbin \"${BASEROM_DIR}/makerom.bin\", 0x40, 0xFC0" > ${ASM_DIR}/makerom/ipl3.s
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/makerom.bin"     "${ASM_DIR}/makerom"                                             --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_makerom.csv"     --variables "${TABLES_DIR}/variables_makerom.csv" --constants "${TABLES_DIR}/constants_makerom.csv"

./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/boot.bin"        "${ASM_DIR}/boot"        --data-output "${DATA_DIR}/boot"        --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_boot.csv"        --save-context "${CONTEXT_DIR}/boot.txt"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_B3C70.bin"  "${ASM_DIR}/file_B3C70"  --data-output "${DATA_DIR}/file_B3C70"  --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_B3C70.csv"  --save-context "${CONTEXT_DIR}/B3C70.txt"

./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_DCF60.bin"  "${ASM_DIR}/file_DCF60"  --data-output "${DATA_DIR}/file_DCF60"  --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_DCF60.csv"  --save-context "${CONTEXT_DIR}/DCF60.txt"  --functions "${TABLES_DIR}/functions_file_DCF60.csv"  --variables "${TABLES_DIR}/variables_file_DCF60.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_107190.bin" "${ASM_DIR}/file_107190" --data-output "${DATA_DIR}/file_107190" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_107190.csv" --save-context "${CONTEXT_DIR}/107190.txt" --functions "${TABLES_DIR}/functions_file_107190.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_10F7F0.bin" "${ASM_DIR}/file_10F7F0" --data-output "${DATA_DIR}/file_10F7F0" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_10F7F0.csv" --save-context "${CONTEXT_DIR}/10F7F0.txt" --functions "${TABLES_DIR}/functions_file_10F7F0.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_1426B0.bin" "${ASM_DIR}/file_1426B0" --data-output "${DATA_DIR}/file_1426B0" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_1426B0.csv" --save-context "${CONTEXT_DIR}/1426B0.txt" --functions "${TABLES_DIR}/functions_file_1426B0.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_182B40.bin" "${ASM_DIR}/file_182B40" --data-output "${DATA_DIR}/file_182B40" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_182B40.csv" --save-context "${CONTEXT_DIR}/182B40.txt" --functions "${TABLES_DIR}/functions_file_182B40.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_19C470.bin" "${ASM_DIR}/file_19C470" --data-output "${DATA_DIR}/file_19C470" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_19C470.csv" --save-context "${CONTEXT_DIR}/19C470.txt" --functions "${TABLES_DIR}/functions_file_19C470.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_1C5E50.bin" "${ASM_DIR}/file_1C5E50" --data-output "${DATA_DIR}/file_1C5E50" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_1C5E50.csv" --save-context "${CONTEXT_DIR}/1C5E50.txt" --functions "${TABLES_DIR}/functions_file_1C5E50.csv" --variables "${TABLES_DIR}/variables_file_1C5E50.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_1FE3D0.bin" "${ASM_DIR}/file_1FE3D0" --data-output "${DATA_DIR}/file_1FE3D0" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_1FE3D0.csv" --save-context "${CONTEXT_DIR}/1FE3D0.txt" --functions "${TABLES_DIR}/functions_file_1FE3D0.csv" --variables "${TABLES_DIR}/variables_file_1FE3D0.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_2535D0.bin" "${ASM_DIR}/file_2535D0" --data-output "${DATA_DIR}/file_2535D0" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_2535D0.csv" --save-context "${CONTEXT_DIR}/2535D0.txt" --functions "${TABLES_DIR}/functions_file_2535D0.csv" --variables "${TABLES_DIR}/variables_file_2535D0.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_29CA40.bin" "${ASM_DIR}/file_29CA40" --data-output "${DATA_DIR}/file_29CA40" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_29CA40.csv" --save-context "${CONTEXT_DIR}/29CA40.txt" --functions "${TABLES_DIR}/functions_file_29CA40.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_2BD950.bin" "${ASM_DIR}/file_2BD950" --data-output "${DATA_DIR}/file_2BD950" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_2BD950.csv" --save-context "${CONTEXT_DIR}/2BD950.txt" --functions "${TABLES_DIR}/functions_file_2BD950.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_2DA640.bin" "${ASM_DIR}/file_2DA640" --data-output "${DATA_DIR}/file_2DA640" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_2DA640.csv" --save-context "${CONTEXT_DIR}/2DA640.txt" --functions "${TABLES_DIR}/functions_file_2DA640.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_31AA90.bin" "${ASM_DIR}/file_31AA90" --data-output "${DATA_DIR}/file_31AA90" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_31AA90.csv" --save-context "${CONTEXT_DIR}/31AA90.txt" --functions "${TABLES_DIR}/functions_file_31AA90.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_3728F0.bin" "${ASM_DIR}/file_3728F0" --data-output "${DATA_DIR}/file_3728F0" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_3728F0.csv" --save-context "${CONTEXT_DIR}/3728F0.txt" --functions "${TABLES_DIR}/functions_file_3728F0.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_3C8950.bin" "${ASM_DIR}/file_3C8950" --data-output "${DATA_DIR}/file_3C8950" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_3C8950.csv" --save-context "${CONTEXT_DIR}/3C8950.txt" --functions "${TABLES_DIR}/functions_file_3C8950.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_3E3D00.bin" "${ASM_DIR}/file_3E3D00" --data-output "${DATA_DIR}/file_3E3D00" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_3E3D00.csv" --save-context "${CONTEXT_DIR}/3E3D00.txt" --functions "${TABLES_DIR}/functions_file_3E3D00.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_3F6EF0.bin" "${ASM_DIR}/file_3F6EF0" --data-output "${DATA_DIR}/file_3F6EF0" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_3F6EF0.csv" --save-context "${CONTEXT_DIR}/3F6EF0.txt" --functions "${TABLES_DIR}/functions_file_3F6EF0.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_417E50.bin" "${ASM_DIR}/file_417E50" --data-output "${DATA_DIR}/file_417E50" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_417E50.csv" --save-context "${CONTEXT_DIR}/417E50.txt" --functions "${TABLES_DIR}/functions_file_417E50.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_430E20.bin" "${ASM_DIR}/file_430E20" --data-output "${DATA_DIR}/file_430E20" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_430E20.csv" --save-context "${CONTEXT_DIR}/430E20.txt" --functions "${TABLES_DIR}/functions_file_430E20.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_44E2E0.bin" "${ASM_DIR}/file_44E2E0" --data-output "${DATA_DIR}/file_44E2E0" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_44E2E0.csv" --save-context "${CONTEXT_DIR}/44E2E0.txt" --functions "${TABLES_DIR}/functions_file_44E2E0.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_456EF0.bin" "${ASM_DIR}/file_456EF0" --data-output "${DATA_DIR}/file_456EF0" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_456EF0.csv" --save-context "${CONTEXT_DIR}/456EF0.txt" --functions "${TABLES_DIR}/functions_file_456EF0.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_47EBD0.bin" "${ASM_DIR}/file_47EBD0" --data-output "${DATA_DIR}/file_47EBD0" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_47EBD0.csv" --save-context "${CONTEXT_DIR}/47EBD0.txt" --functions "${TABLES_DIR}/functions_file_47EBD0.csv"
./tools/py-mips-disasm/simpleDisasm.py "${BASEROM_DIR}/file_4A49D0.bin" "${ASM_DIR}/file_4A49D0" --data-output "${DATA_DIR}/file_4A49D0" --variables "${TABLES_DIR}/variables_hardware_regs.csv" --variables "${TABLES_DIR}/variables_libultra.csv" --variables ${VARIABLES} --functions ${FUNCTIONS} --file-splits "${TABLES_DIR}/files_file_4A49D0.csv" --save-context "${CONTEXT_DIR}/4A49D0.txt" --functions "${TABLES_DIR}/functions_file_4A49D0.csv"
